@startuml
skinparam class {
  BackgroundColor<<Entity>> Wheat
  BackgroundColor<<AggregateRoot>> LightYellow
  BackgroundColor<<Factory>> LightBlue
  BackgroundColor<<ValueObject>> LightGreen
  BackgroundColor<<DomainService>> LightCyan
}

' ========================
' Entities / Aggregate Root
' ========================
class Alert <<AggregateRoot>> {
  - alertId: long
  - type: AlertType
  - status: AlertStatus
  - sensorType: SensorType
  - createdAt: DateTime
  - acknowledgedAt: DateTime
  - closedAt: DateTime
  --
  + acknowledge()
  + close()
  + escalate()
}

class Notification <<Entity>> {
  - notificationId: long
  - alertId: long
  - channel: NotificationChannel
  - message: String
  - sentAt: DateTime
  --
  + markAsSent()
}

class Incident <<Entity>> {
  - incidentId: long
  - alertId: long
  - tripId: long
  - description: String
  - createdAt: DateTime
  --
  + resolve(description: String)
}

' ========================
' Factories
' ========================
class AlertFactory <<Factory>> {
  + createAlert(type, sensorType, createdAt): Alert
}

class IncidentFactory <<Factory>> {
  + createIncident(alertId, tripId, description): Incident
}

' ========================
' Value Objects
' ========================
class AlertType <<ValueObject>> {
  {enum} OutOfRange
  {enum} Offline
  {enum} RouteDeviation
}

class AlertStatus <<ValueObject>> {
  {enum} OPEN
  {enum} ACKNOWLEDGED
  {enum} CLOSED
}

class SensorType <<ValueObject>> {
  {enum} TEMPERATURE
  {enum} HUMIDITY
  {enum} VIBRATION
  {enum} TILT
  {enum} LOCATION
  {enum} BATTERY
}

class NotificationChannel <<ValueObject>> {
  {enum} EMAIL
  {enum} SMS
  {enum} FCM
}

' ========================
' Domain Services
' ========================
class AlertCommandService <<DomainService>> {
  + createAlert()
  + acknowledgeAlert()
  + closeAlert()
  + escalateAlert()
  + createIncidentFromAlert()
}

class AlertQueryService <<DomainService>> {
  + getAlertById()
  + getAlertsByStatus()
  + getAlertsByType()
  + getNotificationsByAlertId()
  + getIncidentsByAlertId()
}

' ========================
' Relationships
' ========================
Alert "1" o-- "*" Notification
Alert "1" o-- "*" Incident

AlertFactory --> Alert
IncidentFactory --> Incident

Alert --> AlertType
Alert --> AlertStatus
Alert --> SensorType
Notification --> NotificationChannel

AlertCommandService --> Alert
AlertQueryService --> Alert
AlertQueryService --> Notification
AlertQueryService --> Incident
@enduml